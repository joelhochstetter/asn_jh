function plotDeltaG(G, pn, fitP)
%{
    Plots the distribution of DeltaG
    Inputs:
        G: Conductance time-series
      net: Plot total DeltaG with both positive and negative fluctuations
       pn: if 1 plots +ve and -ve separately on the same axis. Else we plot
            them together
     fitP: A struct containing parameters to fit
        fitP.lc:    Lower cut-off of dG in units of G
        fitP.uc:    Upper cut-off of dG in units of G
        fitP.lcn:    Lower cut-off of dG in units of G for dG < 0 fit
        fitP.ucn:    Upper cut-off of dG in units of G for dG < 0 fit

    Option to fit if we provide cut-offs

%}
    
    if nargin == 2
        fitPL = 0;
    else
        fitPL = 1;
    end
    
    dG = [diff(G), 0];
    dG(isnan(dG)) = 0;    
    
    if fitPL
        if ~isfield(fitP, 'lc')
            fitP.lc = 0;
        end

        if ~isfield(fitP, 'uc')
            fitP.uc = 10*max(abs(dG));
        end    
        
        if ~isfield(fitP, 'lcn')
            fitP.lc = 0;
        end

        if ~isfield(fitP, 'ucn')
            fitP.uc = 10*max(abs(dG));
        end            
    end


    if pn
        [N,edges] = histcounts(abs(dG(dG > 0)), 'Normalization', 'probability');
        loglog((edges(1:end-1) + edges(2:end))/2,N, 'bx')
        hold on;
        [N1,edges1] = histcounts(abs(dG(dG < 0)), 'Normalization', 'probability');
        loglog((edges1(1:end-1) + edges1(2:end))/2,N1, 'rx')
        legend('\Delta G > 0', '\Delta G < 0')
        title('\Delta G distribution')
        xlabel('\Delta G')
        ylabel('P(\Delta G)') 
        
        if fitPL
            %only include bins within include range to fit
            fitEdges = edges((edges >= fitP.lc) & (edges <= fitP.uc));
            cutFront = numel(edges(edges < fitP.lc));
            cutEnd   = numel(edges(edges > fitP.uc));
            edgeCen  = (fitEdges(1:end-1)  + fitEdges(2:end))/2;
            fitN     = N(1 + cutFront : end - cutEnd);
         
            %fit power law
            [fitresult, xData, yData, gof] = fitPowerLaw(edgeCen , fitN );    
            plot(fitresult, 'b--', xData, yData, 'gx')
            
            %repeat for dG < 0
            fitP.lcn = fitP.lc;
            fitP.ucn = fitP.uc;
            fitEdges = edges1((edges1 >= fitP.lcn) & (edges1 <= fitP.ucn));
            cutFront = numel(edges1(edges1 < fitP.lcn));
            cutEnd   = numel(edges1(edges1 > fitP.ucn));
            edgeCen1 = (fitEdges(1:end-1)  + fitEdges(2:end))/2;
            fitN1    = N1(1 + cutFront : end - cutEnd);

            [fitresult, xData, yData, gof] = fitPowerLaw(edgeCen1, fitN1);
            plot(fitresult, 'r--', xData, yData, 'mx')
            legend('\Delta G > 0 not fit', '\Delta G < 0 not fit', ...
                '\Delta G > 0 inc fit', '\Delta G > 0 fit', ...
                '\Delta G < 0 inc fit', '\Delta G < 0 fit')
            
            title('\Delta G > 0: ')
        else
            legend('\Delta G > 0', '\Delta G < 0')
        end
       
    else %~pn
        [N,edges] = histcounts(abs(dG), 'Normalization', 'probability');
        loglog((edges(1:end-1) + edges(2:end))/2,N, 'bx')
        hold on;
        title('\Delta G distribution')
        xlabel('\Delta G')
        ylabel('P(\Delta G)') 
        
        
        if fitPL
            %only include bins within include range to fit
            fitEdges = edges((edges >= fitP.lc) & (edges <= fitP.uc));
            cutFront = numel(edges(edges < fitP.lc));
            cutEnd   = numel(edges(edges > fitP.uc));
            edgeCen  = (fitEdges(1:end-1)  + fitEdges(2:end))/2;
            fitN     = N(1 + cutFront : end - cutEnd);
         
            %fit power law
            [fitresult, xData, yData, gof] = fitPowerLaw(edgeCen , fitN );    
            plot(fitresult, 'b--', xData, yData, 'gx')
            
            legend('not fit', 'inc fit', 'fit')        
        end
        
    end
    set(gca, 'XScale', 'log')
    set(gca, 'YScale', 'log')


end