function [binned,  times,  binJoinPeriod] = binWithJoins(data, tStep, joinPeriod)
%{
    Puts data into bins according with the tStep an integer corresponding
    to how many time-points per bin
    roundUp: is whether to round up number of bins. 
        default = false. Round down so exclude elements 
        in the last few bins

    Outputs:
              binned: sum of the data that goes in that bin
                times: the central time-point for each bin
   binJoinPeriod: array of the join

%}
    

    if numel(joinPeriod) <= 0
        binJoinPeriod = -1;
        binned = binData(data, tStep);
        return;
    elseif numel(joinPeriod) == 1
        joinPeriod = [0, joinPeriod:joinPeriod:numel(data)];
    end
    
    data = reshape(data, [numel(data),1]);
    
    numPeriods = numel(joinPeriod) - 1;
    
    binned = zeros(numPeriods*tStep, 1);
    times   = zeros(numPeriods*tStep, 1); 
    sidx = 1; %start index
    
    binJoinPeriod = zeros(numPeriods,1);
    
    for j = 1:numPeriods
        N = floor((joinPeriod(j+1) - joinPeriod(j))/tStep) - 1;
        binJoinPeriod(j) = sidx + N;
        binned(sidx:sidx+N) = binData(data(1+joinPeriod(j):joinPeriod(j+1)), tStep, false);
        times(j) = floor(sidx + N/2); 
        sidx = sidx + N + 1;
    end
    

end